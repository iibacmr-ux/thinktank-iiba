<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ThinkTank IIBA √ó GECAM ‚Äî App</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" defer></script>

  <!-- Charge (optionnel) le JSON avant l'app -->
  <script>
    window.__CONFIG_JSON__ = null;
    (async function () {
      try {
        const res = await fetch('config_complete.json', { cache: 'no-store' });
        if (res.ok) window.__CONFIG_JSON__ = await res.json();
      } catch (e) {
        console.warn('JSON externe non charg√© (optionnel):', e);
      }
    })();
  </script>
  <script src="app.js" defer></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">IIBA</span>
      <div class="titles">
        <h1>ThinkTank IIBA Cameroun √ó GECAM</h1>
        <p>üìò Livre Blanc ¬∑ üìó Guide ‚Äî √âch√©ance : 1·µâ ≥ d√©c. 2025</p>
      </div>
    </div>
    <div class="actions">
      <a class="btn primary" target="_blank" rel="noopener"
         href="https://docs.google.com/forms/d/e/1FAIpQLSeBG3ihN55tvoaD_gbLzoi81Fmrn6eN2rV3KHUPdntgNV2NOw/viewform?usp=sharing&ouid=110996219267002131665">
        Devenir b√©n√©vole
      </a>
      <button class="btn icon" id="btnAdmin" title="Admin & param√®tres">‚öôÔ∏è</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="projet">Projet</button>
    <button class="tab" data-tab="planning">Planning</button>
    <button class="tab" data-tab="team">√âquipe & Ressources</button>
    <button class="tab" data-tab="admin">Import/Export</button>
  </nav>

  <main class="container">
    <!-- Onglet Projet -->
    <section class="tabview active" id="tab-projet">
      <div class="grid-2">
        <div>
          <h2>Dashboard Kanban</h2>
          <div class="kanban">
            <div class="column"><h3>Icebox</h3><div class="list" data-status="Icebox"></div></div>
            <div class="column"><h3>√Ä faire</h3><div class="list" data-status="A_faire"></div></div>
            <div class="column"><h3>En cours</h3><div class="list" data-status="En_cours"></div></div>
            <div class="column"><h3>En revue</h3><div class="list" data-status="En_revue"></div></div>
            <div class="column"><h3>Termin√©</h3><div class="list" data-status="Termine"></div></div>
          </div>
        </div>
        <div>
          <h2>Analytics</h2>
          <div class="cards">
            <div class="kpi"><span id="kpiTasks">0</span><small>Sous-sections</small></div>
            <div class="kpi"><span id="kpiContribs">0</span><small>Contributeurs</small></div>
            <div class="kpi"><span id="kpiCoverage">0%</span><small>Couverture</small></div>
          </div>
          <canvas id="burndown" height="140"></canvas>
          <canvas id="statusChart" height="140"></canvas>
        </div>
      </div>
    </section>

    <!-- Onglet Planning -->
    <section class="tabview" id="tab-planning">
      <h2>Jalons</h2>
      <table class="table" id="milestonesTbl">
        <thead><tr><th>ID</th><th>Titre</th><th>Date</th><th>Owner</th><th>Statut</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Onglet √âquipe & Ressources -->
    <section class="tabview" id="tab-team">
      <div class="grid-2">
        <div>
          <h2>Affectations</h2>
          <table class="table" id="affectationsTable">
            <thead>
              <tr>
                <th>ID</th><th>Titre</th><th>Document</th><th>Section</th>
                <th>Coordinateur</th><th>Contributeurs</th><th>Statut</th><th>√âch√©ance</th><th>Risque</th><th>Action</th>
              </tr>
            </thead>
            <tbody id="affectationsTableBody"></tbody>
          </table>
        </div>
        <div>
          <h2>Ressources</h2>
          <div class="doc-columns">
            <div><h3>üìò Livre Blanc</h3><div id="lbList" class="doclist"></div></div>
            <div><h3>üìó Guide</h3><div id="gdList" class="doclist"></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Onglet Admin (Import/Export) -->
    <section class="tabview" id="tab-admin">
      <h2>Import / Export</h2>
      <div class="row">
        <button id="exportExcel" class="btn primary">Exporter Excel multi-onglets</button>
        <button id="exportJson" class="btn">Exporter JSON</button>
        <button id="importExcel" class="btn">Importer Excel</button>
        <input type="file" id="inputExcel" hidden accept=".xlsx,.xls">
      </div>
      <p class="muted small">Onglets export√©s : SousSections ¬∑ Contributeurs ¬∑ Jalons ¬∑ Projet ¬∑ RiskLabels.</p>
    </section>
  </main>

  <footer class="footer">¬© IIBA Cameroun √ó GECAM ‚Äî 2025</footer>

  <script>
    // Gestion des onglets
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('.tab');
      const views = document.querySelectorAll('.tabview');
      tabs.forEach(btn => btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        views.forEach(v => v.classList.remove('active'));
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
      }));
    });
  </script>
</body>
</html>
